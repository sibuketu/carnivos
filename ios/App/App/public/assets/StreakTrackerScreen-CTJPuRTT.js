import{j as e,u as T,F as E,b as F}from"./index-CvGLKNdl.js";import{r as i}from"./chart-vendor-BKK2UjWf.js";import"./react-vendor-OvXVS5lI.js";import"./ai-vendor-9LcfXvm6.js";function Y({logs:d,onDayClick:c}){const[t,x]=i.useState(new Date),{startDate:k,endDate:f,daysInMonth:g}=i.useMemo(()=>{const a=t.getFullYear(),n=t.getMonth(),s=new Date(a,n,1),r=new Date(a,n+1,0);return{startDate:s,endDate:r,daysInMonth:r.getDate()}},[t]),l=k.getDay(),m=(a,n)=>{const s=new Date(a);return s.setDate(s.getDate()+n),s.toISOString().split("T")[0]},p=i.useMemo(()=>{const a=new Map;return d.forEach(n=>{a.set(n.date,n)}),a},[d]),u=i.useMemo(()=>{const a=new Set,n=[...d].filter(o=>!o.calculatedMetrics?.hasViolation).sort((o,y)=>y.date.localeCompare(o.date));if(n.length===0)return a;const s=new Date().toISOString().split("T")[0];let r=n[0].date===s||n[0].date===m(s,-1)?n[0].date:null;if(r)for(const o of n)if(o.date===r)a.add(o.date),r=m(r,-1);else break;return a},[d]),b=()=>{x(new Date(t.getFullYear(),t.getMonth()-1,1))},S=()=>{x(new Date(t.getFullYear(),t.getMonth()+1,1))},v=a=>{const s=new Date(t.getFullYear(),t.getMonth(),a).toISOString().split("T")[0],r=p.get(s);return u.has(s)?"inStreak":r?r.calculatedMetrics?.hasViolation?"hasViolation":"hasLog":"normal"},w=a=>{const s=new Date(t.getFullYear(),t.getMonth(),a).toISOString().split("T")[0];return u.has(s)},D=["1Êúà","2Êúà","3Êúà","4Êúà","5Êúà","6Êúà","7Êúà","8Êúà","9Êúà","10Êúà","11Êúà","12Êúà"],N=["Êó•","Êúà","ÁÅ´","Ê∞¥","Êú®","Èáë","Âúü"],C=Array.from({length:l},(a,n)=>e.jsx("div",{className:"streak-calendar-day empty"},`empty-${n}`));return e.jsxs("div",{className:"streak-calendar-container",children:[e.jsxs("div",{className:"streak-calendar-header",children:[e.jsx("button",{onClick:b,className:"streak-calendar-nav-button",children:"‚Üê"}),e.jsxs("h3",{className:"streak-calendar-month-title",children:[t.getFullYear(),"Âπ¥ ",D[t.getMonth()]]}),e.jsx("button",{onClick:S,className:"streak-calendar-nav-button",children:"‚Üí"})]}),e.jsx("div",{className:"streak-calendar-weekdays",children:N.map(a=>e.jsx("div",{className:"streak-calendar-weekday",children:a},a))}),e.jsx("div",{className:"streak-calendar-grid-wrapper",children:e.jsxs("div",{className:"streak-calendar-grid",children:[C,Array.from({length:g},(a,n)=>{const s=n+1,r=v(s),o=w(s),h=new Date(t.getFullYear(),t.getMonth(),s).toISOString().split("T")[0],M=m(h,-1),I=m(h,1),z=u.has(M),L=u.has(I),j=p.has(h);return e.jsxs("div",{className:`streak-calendar-day ${r} ${o?"streak":""}`,"data-date":h,"data-day":s,onClick:()=>{j&&c&&c(h)},style:{cursor:j&&c?"pointer":"default"},children:[e.jsx("span",{className:"streak-calendar-day-number",children:s}),o&&e.jsxs(e.Fragment,{children:[z&&e.jsx("div",{className:"streak-line streak-line-left",style:{position:"absolute",top:"50%",left:"-0.5rem",transform:"translateY(-50%)",width:"0.5rem",height:"3px",backgroundColor:"#059669",zIndex:1}}),L&&e.jsx("div",{className:"streak-line streak-line-right",style:{position:"absolute",top:"50%",right:"-0.5rem",transform:"translateY(-50%)",width:"0.5rem",height:"3px",backgroundColor:"#059669",zIndex:1}})]})]},s)})]})}),e.jsxs("div",{className:"streak-calendar-legend",children:[e.jsxs("div",{className:"streak-calendar-legend-item",children:[e.jsx("div",{className:"streak-calendar-legend-color",style:{backgroundColor:"#10b981"}}),e.jsx("span",{children:"ÈÄ£Á∂öË®òÈå≤‰∏≠"})]}),e.jsxs("div",{className:"streak-calendar-legend-item",children:[e.jsx("div",{className:"streak-calendar-legend-color",style:{backgroundColor:"#f9fafb",borderColor:"#e5e7eb"}}),e.jsx("span",{children:"Ë®òÈå≤„Å™„Åó"})]}),e.jsxs("div",{className:"streak-calendar-legend-item",children:[e.jsx("div",{className:"streak-calendar-legend-color",style:{backgroundColor:"#dc2626"}}),e.jsx("span",{children:"ÈÅïÂèç„ÅÇ„Çä"})]})]})]})}function R({onBack:d}){const{t:c}=T(),[t,x]=i.useState(null),[k,f]=i.useState([]);return i.useEffect(()=>{const g=async()=>{const[m,p]=await Promise.all([E(),F()]);x(m),f(p)};g();const l=()=>{g()};return window.addEventListener("dailyLogUpdated",l),window.addEventListener("screenChanged",l),()=>{window.removeEventListener("dailyLogUpdated",l),window.removeEventListener("screenChanged",l)}},[]),t?e.jsx("div",{className:"streak-tracker-screen-container",children:e.jsxs("div",{className:"streak-tracker-screen-content",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"2rem",gap:"1rem"},children:[e.jsx("button",{onClick:d,style:{background:"none",border:"none",fontSize:"24px",cursor:"pointer",color:"#6b7280"},children:"‚Üê"}),e.jsxs("h1",{style:{fontSize:"24px",fontWeight:"bold",margin:0},children:["üî• ",c("streak.title")]})]}),e.jsxs("div",{style:{textAlign:"center",marginBottom:"2rem",padding:"1.5rem",backgroundColor:"white",borderRadius:"16px",border:"1px solid #e5e7eb"},children:[e.jsx("div",{style:{fontSize:"64px",fontWeight:"bold",color:"#dc2626",marginBottom:"0.5rem"},children:t.currentStreak}),e.jsx("div",{style:{fontSize:"16px",color:"#6b7280",marginBottom:"1rem"},children:"Êó•ÈÄ£Á∂ö"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0.75rem",backgroundColor:"#fef2f2",borderRadius:"8px",marginBottom:"0.5rem"},children:[e.jsx("span",{style:{fontSize:"14px",color:"#78716c"},children:"ÁèæÂú®„ÅÆ„Éï„Çß„Éº„Ç∫"}),e.jsx("span",{style:{fontSize:"16px",fontWeight:"bold",color:"#dc2626"},children:t.phase})]}),t.nextPhase&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0.75rem",backgroundColor:"#f9fafb",borderRadius:"8px",marginBottom:t.longestStreak>0?"0.5rem":"0"},children:[e.jsx("span",{style:{fontSize:"14px",color:"#6b7280"},children:"Ê¨°„ÅÆ„Éï„Çß„Éº„Ç∫„Åæ„Åß"}),e.jsx("span",{style:{fontSize:"16px",fontWeight:"bold",color:"#1f2937"},children:t.daysUntilNextPhase!==null?`${t.daysUntilNextPhase}Êó•`:"---"})]}),t.longestStreak>0&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0.75rem",backgroundColor:"#f9fafb",borderRadius:"8px"},children:[e.jsx("span",{style:{fontSize:"14px",color:"#6b7280"},children:"ÊúÄÈï∑Ë®òÈå≤"}),e.jsxs("span",{style:{fontSize:"18px",fontWeight:"bold",color:"#1f2937"},children:[t.longestStreak,"Êó•"]})]})]}),e.jsx("div",{style:{marginTop:"2rem"},children:e.jsx(Y,{logs:k,onDayClick:g=>{const l=new CustomEvent("navigateToScreen",{detail:"history"});window.dispatchEvent(l)}})})]})}):e.jsx("div",{className:"streak-tracker-screen-container",children:e.jsxs("div",{className:"streak-tracker-screen-content",children:[e.jsxs("button",{onClick:d,style:{background:"none",border:"none",fontSize:"24px",cursor:"pointer",color:"#6b7280",marginBottom:"1rem"},children:["‚Üê ",c("common.back")]}),e.jsx("div",{style:{textAlign:"center",padding:"2rem"},children:e.jsx("div",{style:{fontSize:"16px",color:"#6b7280"},children:c("common.loading")})})]})})}export{R as default};
