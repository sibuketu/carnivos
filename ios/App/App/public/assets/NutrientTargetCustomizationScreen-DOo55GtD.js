import{u as N,a as f,d as j,t as b,j as t}from"./index-CvGLKNdl.js";import{r as m}from"./chart-vendor-BKK2UjWf.js";import"./react-vendor-OvXVS5lI.js";import"./ai-vendor-9LcfXvm6.js";const x=["protein","fat","sodium","magnesium","potassium","zinc","iron","vitaminA","vitaminD","vitaminK2"],z={protein:{name:"タンパク質",unit:"g"},fat:{name:"脂質",unit:"g"},sodium:{name:"ナトリウム",unit:"mg"},magnesium:{name:"マグネシウム",unit:"mg"},potassium:{name:"カリウム",unit:"mg"},zinc:{name:"亜鉛",unit:"mg"},iron:{name:"鉄分",unit:"mg"},vitaminA:{name:"ビタミンA",unit:"IU"},vitaminD:{name:"ビタミンD",unit:"IU"},vitaminK2:{name:"ビタミンK2",unit:"μg"}};function A({onBack:g}){const{t:p}=N(),{userProfile:e,loadUserProfile:u}=f(),[r,c]=m.useState(e?.customNutrientTargets?Object.fromEntries(Object.entries(e.customNutrientTargets).map(([a,n])=>[a,typeof n=="number"?{mode:"manual",value:n}:n])):{}),o=m.useState(null)[0];m.useEffect(()=>{e?.customNutrientTargets&&c(Object.fromEntries(Object.entries(e.customNutrientTargets).map(([a,n])=>[a,typeof n=="number"?{mode:"manual",value:n}:n])))},[e]);const l=m.useMemo(()=>e?j(e.gender,e.age,e.activityLevel,e.isPregnant,e.isBreastfeeding,e.isPostMenopause,e.stressLevel,e.sleepHours,e.exerciseIntensity,e.exerciseFrequency,e.thyroidFunction,e.sunExposureFrequency,e.digestiveIssues,e.inflammationLevel,e.mentalHealthStatus,e.supplementMagnesium,e.supplementVitaminD,e.supplementIodine,e.alcoholFrequency,e.caffeineIntake,e.daysOnCarnivore,e.carnivoreStartDate,e.forceAdaptationMode,e.bodyComposition,e.weight,e.metabolicStressIndicators,void 0):{},[e]);m.useEffect(()=>{o.current&&clearTimeout(o.current);const a=setTimeout(async()=>{if(e){const n={...e,customNutrientTargets:Object.keys(r).length>0?Object.fromEntries(Object.entries(r).map(([i,s])=>[i,s.mode==="auto"?{mode:"auto"}:{mode:"manual",value:s.value}])):void 0};try{await b(n),await u()}catch{}}},1e3);return o.current=a,()=>{o.current&&clearTimeout(o.current)}},[r,e,u]);const d=(a,n)=>{const i={...r};if(n==="auto")delete i[a];else{const s=l[a]||0;i[a]={mode:"manual",value:s}}c(i)},h=(a,n)=>{c({...r,[a]:{mode:"manual",value:n}})};return t.jsx("div",{className:"nutrient-target-customization-screen-container",children:t.jsxs("div",{className:"nutrient-target-customization-screen-content",children:[t.jsxs("div",{className:"screen-header",children:[t.jsx("button",{className:"back-button",onClick:g,"aria-label":p("common.backAriaLabel"),children:"←"}),t.jsx("h1",{className:"screen-header-title",children:"栄養素目標値のカスタマイズ"})]}),t.jsxs("div",{className:"nutrient-target-customization-screen-section",children:[t.jsx("p",{className:"nutrient-target-customization-screen-description",children:"各栄養素の目標値を「推奨値（Auto）」か「手動入力（Manual）」かを選択できます。"}),t.jsx("div",{className:"nutrient-target-customization-screen-list",children:x.map(a=>{const n=r[a]||{mode:"auto"},i=l[a]||0,s=z[a];return t.jsxs("div",{className:"nutrient-target-customization-screen-item",children:[t.jsxs("div",{className:"nutrient-target-customization-screen-item-header",children:[t.jsxs("div",{className:"nutrient-target-customization-screen-item-info",children:[t.jsx("div",{className:"nutrient-target-customization-screen-item-name",children:s.name}),t.jsxs("div",{className:"nutrient-target-customization-screen-item-auto-value",children:["推奨値: ",i.toFixed(1),s.unit]})]}),t.jsxs("div",{className:"nutrient-target-customization-screen-item-buttons",children:[t.jsx("button",{className:`nutrient-target-customization-screen-mode-button ${n.mode==="auto"?"active":""}`,onClick:()=>d(a,"auto"),"aria-label":`${s.name}を自動モードに設定`,children:"Auto"}),t.jsx("button",{className:`nutrient-target-customization-screen-mode-button ${n.mode==="manual"?"active":""}`,onClick:()=>d(a,"manual"),"aria-label":`${s.name}を手動モードに設定`,children:"Manual"})]})]}),n.mode==="manual"&&t.jsxs("div",{className:"nutrient-target-customization-screen-item-manual",children:[t.jsx("label",{className:"nutrient-target-customization-screen-item-manual-label",children:"手動目標値"}),t.jsxs("div",{className:"nutrient-target-customization-screen-item-manual-input-group",children:[t.jsx("input",{type:"number",className:"nutrient-target-customization-screen-item-manual-input",value:n.value??i,onChange:v=>h(a,parseFloat(v.target.value)||void 0),placeholder:i.toString(),min:"0",step:"0.1","aria-label":`${s.name}の手動目標値`}),t.jsx("span",{className:"nutrient-target-customization-screen-item-manual-unit",children:s.unit})]})]})]},a)})})]})]})})}export{A as default};
