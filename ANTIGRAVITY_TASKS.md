# Antigravity タスク指示書

> **作成日**: 2026-02-01
> **目的**: Antigravityに任せるタスクの詳細指示
> **重要**: 以下の指示をそのままAntigravityにコピペして実行させる

---

## 📋 作業前の必須確認

**必ず以下を実行してから作業開始**：

1. `AI_RULES.md` を読む
2. `docs/AGENT_LOG.md` の直近3件を読む
3. プロジェクトパスを確認：
   ```
   C:\Users\susam\Downloads\新しいフォルダー\docs\primal-logic-app\primal-logic-web
   ```

---

## 🎯 タスク1: Lintエラー修正【最優先】

### 目的
リリース前のコード品質向上。約50個のLintエラーを機械的に修正。

### 作業手順

#### ステップ1: 現状確認
```bash
cd "C:\Users\susam\Downloads\新しいフォルダー\docs\primal-logic-app\primal-logic-web"
npm run lint
```

エラーリストを全て確認し、以下の形式でメモ：
```
ファイル名: エラー数
- エラー内容1
- エラー内容2
```

#### ステップ2: エラー修正（エラータイプ別）

**A. 未使用変数（`@typescript-eslint/no-unused-vars`）**

修正方法：
1. 変数が本当に不要 → 削除
2. 将来使う予定 → `_` プレフィックスを付ける（例: `error` → `_error`）
3. 関数の引数で必須 → `_` プレフィックスを付ける

例：
```typescript
// 修正前
const [showAuth, setShowAuth] = useState(false);

// 修正後（不要なら削除）
// 削除

// 修正後（将来使うなら）
const [_showAuth, setShowAuth] = useState(false);
```

**B. `any` 型の使用（`@typescript-eslint/no-explicit-any`）**

修正方法：
1. 型が分かる場合 → 適切な型を指定
2. 型が不明な場合 → `unknown` を使う
3. オブジェクトの場合 → `Record<string, unknown>` を使う

例：
```typescript
// 修正前
const handleError = (error: any) => { ... }

// 修正後
const handleError = (error: unknown) => { ... }

// 修正前
const data: any = { ... }

// 修正後
const data: Record<string, unknown> = { ... }
```

**C. React Hooks関連（`react-hooks/set-state-in-effect`）**

修正方法：
1. useEffectの中でsetStateを呼んでいる場合
2. 依存配列を確認して、無限ループにならないか確認
3. 問題がある場合は、useMemoやuseCallbackでラップ

例：
```typescript
// 修正前（問題あり）
useEffect(() => {
  setAmount(calculatedAmount);
}, [packSize, portion, unit]);

// 修正後（派生状態として計算）
const amount = useMemo(() => {
  if (portion !== null && unit === 'g') {
    return Math.round(packSize * portion);
  }
  return defaultAmount;
}, [packSize, portion, unit]);
```

**D. その他のエラー**

- 正規表現のエスケープ（`no-useless-escape`）: 不要な `\` を削除
- 空のブロック（`no-empty`）: `{}` → `{ /* 意図的に空 */ }` または処理を追加
- `prefer-const`: `let` → `const` に変更（再代入していない場合）

#### ステップ3: 修正後の確認
```bash
npm run lint
```

エラーが0になるまで繰り返す。

#### ステップ4: 動作確認
```bash
npm run dev
```

ブラウザで以下を確認：
- [ ] ホーム画面が表示される
- [ ] 食品入力ができる
- [ ] エラーが出ていない

#### ステップ5: 作業ログ追記

`docs/AGENT_LOG.md` の末尾に以下を追加：

```md
## 2026-02-01 HH:MM (Agent: Antigravity)
- 目的: Lintエラー修正
- 変更点(要約): 約XX個のLintエラーを修正
- 触ったファイル:
  - src/App.tsx
  - src/components/MiniNutrientGauge.tsx
  - （他、修正したファイル全て）
- 動作影響: コード品質向上、エラー0件
- テスト/確認: npm run lint（エラー0件）、npm run dev（動作確認OK）
- 残タスク/懸念: なし
```

### 注意事項

❌ **禁止事項**：
- 既存のロジックを変更しない
- UIの挙動を変えない
- わからないエラーは無理に修正しない（Claude Codeに報告）

✅ **許可事項**：
- 未使用変数の削除
- `any` → `unknown` への変更
- `_` プレフィックスの追加
- `let` → `const` への変更

### エラー発生時の対応

1. テストが失敗した場合 → 修正を戻す
2. アプリが起動しない場合 → 修正を戻す
3. 3回試して解決しない場合 → Claude Codeに報告

---

## 🎯 タスク2: プライバシーポリシー・利用規約作成【高優先】

### 目的
リリース必須の法的ドキュメント作成。既存アプリを参考に日本語で作成。

### 作業手順

#### ステップ1: 参考アプリのプライバシーポリシー収集

以下のアプリのプライバシーポリシーをWeb検索で取得：

1. MyFitnessPal
   - 検索キーワード: "MyFitnessPal プライバシーポリシー 日本語"
   - URLを取得してWebFetchで読み込む

2. Noom
   - 検索キーワード: "Noom プライバシーポリシー 日本語"
   - URLを取得してWebFetchで読み込む

3. Cronometer
   - 検索キーワード: "Cronometer privacy policy"
   - URLを取得してWebFetchで読み込む（英語でも可）

#### ステップ2: プライバシーポリシー作成

以下の構成で `public/privacy-policy.md` を作成：

```markdown
# プライバシーポリシー

最終更新日: 2026年2月1日

CarnivOS（以下「当アプリ」）は、ユーザーの個人情報保護を重視しています。

## 1. 収集する情報

当アプリは以下の情報を収集します：

- 食事記録データ（食品名、量、栄養素）
- 体重・体調記録データ
- アプリの利用状況（匿名）

## 2. 情報の使用目的

収集した情報は以下の目的で使用します：

- 栄養管理機能の提供
- AI推奨機能の改善
- アプリの品質向上

## 3. データの保存と管理

- データはローカルストレージに保存されます
- ユーザーの同意なしに第三者に共有されることはありません
- データは暗号化されて保護されます

## 4. ユーザーの権利

ユーザーは以下の権利を有します：

- データのエクスポート
- データの削除
- 個人情報の訂正

## 5. データの保存期間

- データはユーザーが削除するまで保存されます
- アカウント削除時に全データを削除できます

## 6. セキュリティ

- 業界標準のセキュリティ対策を実施
- データの不正アクセス防止
- 定期的なセキュリティ監査

## 7. Cookie・トラッキング

- 必要最小限のCookieのみ使用
- トラッキングはユーザーの同意が必要

## 8. 第三者サービス

当アプリは以下の第三者サービスを使用します：

- Gemini API（Google）: AI機能提供
- Supabase: データベース・認証

## 9. 子供のプライバシー

- 13歳未満のユーザーは保護者の同意が必要

## 10. プライバシーポリシーの変更

- 重要な変更がある場合はアプリ内で通知

## 11. お問い合わせ

プライバシーに関する質問は以下まで：

- メール: [メールアドレス]
- アプリ内フィードバック機能

---

このプライバシーポリシーは、個人情報保護法およびGDPRに準拠しています。
```

#### ステップ3: 利用規約作成

以下の構成で `public/terms-of-service.md` を作成：

```markdown
# 利用規約

最終更新日: 2026年2月1日

## 1. 規約への同意

CarnivOS（以下「当アプリ」）を使用することで、本利用規約に同意したものとみなします。

## 2. サービスの提供

当アプリは以下のサービスを提供します：

- 栄養管理機能
- AI推奨機能
- 食事記録・履歴管理

## 3. ユーザーの責任

ユーザーは以下の責任を負います：

- 正確な情報の入力
- アカウント情報の適切な管理
- 不正利用の禁止

## 4. 禁止事項

以下の行為を禁止します：

- 不正アクセス
- システムへの攻撃
- 他のユーザーへの迷惑行為
- 商業目的での無断利用

## 5. 知的財産権

- アプリのコンテンツは当アプリに帰属
- ユーザーが作成したデータはユーザーに帰属

## 6. 免責事項

当アプリは以下について責任を負いません：

- 医療アドバイスの提供（当アプリは医療機器ではありません）
- データ損失（バックアップ推奨）
- サービスの中断

## 7. サービスの変更・終了

- 事前通知なしにサービスを変更・終了する場合があります

## 8. 利用規約の変更

- 重要な変更がある場合はアプリ内で通知

## 9. 準拠法・管轄

- 日本法に準拠
- 東京地方裁判所を専属的合意管轄裁判所とします

## 10. お問い合わせ

利用規約に関する質問は以下まで：

- メール: [メールアドレス]
- アプリ内フィードバック機能

---

CarnivOS 運営チーム
```

#### ステップ4: ファイル配置確認

```bash
ls -la public/privacy-policy.md
ls -la public/terms-of-service.md
```

#### ステップ5: 作業ログ追記

`docs/AGENT_LOG.md` の末尾に以下を追加：

```md
## 2026-02-01 HH:MM (Agent: Antigravity)
- 目的: プライバシーポリシー・利用規約作成
- 変更点(要約): リリース必須の法的ドキュメントを作成
- 触ったファイル:
  - public/privacy-policy.md（新規作成）
  - public/terms-of-service.md（新規作成）
- 動作影響: リリース要件を満たす法的ドキュメントが完成
- テスト/確認: ファイルの存在確認、内容の妥当性チェック
- 残タスク/懸念: メールアドレスの追加が必要（ユーザーに確認）
- 参考: MyFitnessPal、Noomのプライバシーポリシーを参考
```

### 注意事項

❌ **禁止事項**：
- 既存アプリから丸コピー（著作権侵害）
- 推測で書く（法的リスク）
- 不正確な情報（GDPRや個人情報保護法に違反）

✅ **許可事項**：
- 既存アプリの構成を参考にする
- 標準的な条項を使用
- 日本語で分かりやすく書く

---

## 🎯 タスク3: アクセシビリティチェック【低優先】

### 目的
WCAG 2.1基準に準拠したアクセシビリティチェック。

### 作業手順

#### ステップ1: ツールのインストール

axe DevTools Chrome拡張をインストール：
```
https://chrome.google.com/webstore/detail/axe-devtools-web-accessibility-testing/lhdoppojpmngadmnindnejefpokejbdd
```

#### ステップ2: アプリ起動

```bash
cd "C:\Users\susam\Downloads\新しいフォルダー\docs\primal-logic-app\primal-logic-web"
npm run dev
```

#### ステップ3: 各ページでチェック実行

以下のページでaxe DevToolsを実行：

1. ホーム画面（`/`）
2. 食品入力画面（`/input`）
3. 履歴画面（`/history`）
4. 設定画面（`/settings`）

各ページで：
- [ ] axe DevToolsを開く
- [ ] "Scan"ボタンをクリック
- [ ] エラー・警告をリスト化

#### ステップ4: エラーのリスト化

`docs/ACCESSIBILITY_REPORT.md` を作成：

```markdown
# アクセシビリティレポート

作成日: 2026-02-01

## ホーム画面

### エラー（重大）
- [ ] エラー1: 内容
- [ ] エラー2: 内容

### 警告（中程度）
- [ ] 警告1: 内容
- [ ] 警告2: 内容

## 食品入力画面

（同様にリスト化）

## 修正した項目

- [x] 画像にaltタグを追加
- [x] ボタンにaria-labelを追加

## 残りの課題

- [ ] コントラスト比の改善（Claude Codeに依頼）
- [ ] キーボードナビゲーションの改善（Claude Codeに依頼）
```

#### ステップ5: 簡単な修正を実施

以下は修正可能：
- 画像の `alt` 属性追加
- ボタンの `aria-label` 追加
- フォームの `label` 追加

以下はClaude Codeに依頼：
- コントラスト比の変更（色の調整）
- キーボードナビゲーションの実装
- フォーカス表示の改善

#### ステップ6: 作業ログ追記

`docs/AGENT_LOG.md` の末尾に追加。

---

## 📊 完了基準

### タスク1: Lintエラー修正
- [ ] `npm run lint` でエラー0件
- [ ] `npm run dev` で動作確認OK
- [ ] `docs/AGENT_LOG.md` に作業ログ追記

### タスク2: プライバシーポリシー・利用規約
- [ ] `public/privacy-policy.md` 作成
- [ ] `public/terms-of-service.md` 作成
- [ ] 内容の妥当性チェック
- [ ] `docs/AGENT_LOG.md` に作業ログ追記

### タスク3: アクセシビリティチェック
- [ ] `docs/ACCESSIBILITY_REPORT.md` 作成
- [ ] 簡単な修正を実施
- [ ] `docs/AGENT_LOG.md` に作業ログ追記

---

## 🚨 エスカレーション条件

以下の場合はClaude Codeに報告：

1. 3回試して解決しない問題
2. アプリが起動しない
3. テストが失敗する
4. わからないエラー
5. UIの挙動が変わった

---

最終更新: 2026-02-01
